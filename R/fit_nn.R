

fit_nn <- function(data,
                   n_proj_years = 2){
  require(neuralnet)

  # Fit deep NN ----
  nn <- neuralnet(log(weight) ~ age+year,
                  data = data,
                  hidden = c(5,5,5,5),
                  linear.output = TRUE,
                  stepmax = 1e6,
                  lifesign = 'minimal',
                  rep=1)

  # Predict ----
  years <- do.call(seq, as.list(range(data$year)))
  proj_years <- (max(years) + 1):(max(years) + n_proj_years)
  ages <- do.call(seq, as.list(range(data$age)))
  years_ages <- expand.grid(years, ages)
  colnames(years_ages) <- c("year", "age")

  years_ages$pred_weight <- exp(predict(nn, newdata = years_ages))

  # Build and fit ----

  # Return ----
  return(list(obj = nn, data = data, report = years_ages))
}

